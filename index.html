<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name = "viewport" content="width=device-width, initial-scale=1, user-scalable=no" />

    <title>Esprit</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>

    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://jeromeetienne.github.io/AR.js/aframe/build/aframe-ar.js"></script>
    <script src="https://raw.githack.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>
    <script
        src="https://raw.githack.com/AR-js-org/studio-backend/master/src/modules/marker/tools/gesture-detector.js"></script>
        <script
        src="https://raw.githack.com/AR-js-org/studio-backend/master/src/modules/marker/tools/gesture-handler.js"></script>

    <link href="https://fonts.googleapis.com/css?family=Open+Sans&display=swap" rel="stylesheet" />
    <style>
        html,
        body {
            height: 100%;
            margin: 0;
            font-family: "Open Sans", sans-serif;
        }

        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
        }

        button {
            font-weight: bold;
            border: none;
            border-radius: 4px;
            background-color: #ed1c24;
            color: #ffffff;
            margin: 5px;
            cursor: pointer;
            border-radius: 20px;
        }

        button:hover {
            background-color: #ab2227;
        }

        .animated-text,
        .innovation-text {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 5vw;
            color: #808080;
            z-index: 10;
            position:absolute;
        }

        .innovation-text {
            display: none;
        }

        .innovation-text .red {
            font-size: 5vw;
            animation-name: scaleBounce;
        }

        .animated-text span,
        .innovation-text span {
            animation-duration: 1s;
            animation-fill-mode: both;
            opacity: 0;
        }

        .heart,
        .red {
            color: #ed1c24;
            animation-name: scaleBounce;
        }

        



        .innovation-text {
            display: none;
        }

        .innovation-text .red {
            font-size: 1.2em;
            animation-name: scaleBounce;
        }

        .animated-text span,
        .innovation-text span,
        img {
            animation-duration: 1s;
            animation-fill-mode: both;
            opacity: 0;
        }

        .heart,
        .red {
            color: #ed1c24;
            animation-name: scaleBounce;
        }

        @keyframes fadeInUp {
            0% {
                opacity: 0;
                transform: translateY(20px);
            }

            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeOutUp {
            0% {
                opacity: 1;
                transform: translateY(0);
            }

            100% {
                opacity: 0;
                transform: translateY(-20px);
            }
        }

        @keyframes fadeIn {
            0% {
                opacity: 0;
            }

            100% {
                opacity: 1;
            }
        }

        @keyframes scaleBounce {

            0%,
            100% {
                opacity: 0;
                transform: scale(0.5);
            }

            75% {
                opacity: 1;
                transform: scale(1.1);
            }

            90% {
                transform: scale(0.95);
            }

            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        .animated-text span:nth-child(1) {
            animation-name: fadeInUp;
            animation-delay: 1s;
        }

        .animated-text span:nth-child(2) {
            animation-name: fadeInUp;
            animation-delay: 1.2s;
        }

        .heart {
            animation-delay: 1.4s;
        }

        .animated-text span:nth-child(4) {
            animation-name: fadeInUp;
            animation-delay: 1.6s;
        }

        .animated-text span:nth-child(5) {
            animation-name: fadeInUp;
            animation-delay: 2s;
        }

        .animated-text span:nth-child(6) {
            animation-name: fadeInUp;
            animation-delay: 2.4s;
        }

        .innovation-text span:nth-child(1) {
            animation-name: scaleBounce;
            animation-delay: 0s;
        }

        .innovation-text span:nth-child(2) {
            animation-name: fadeInUp;
            animation-delay: 0.2s;
        }

        .innovation-text span:nth-child(3) {
            animation-name: fadeInUp;
            animation-delay: 0.4s;
        }


        .innovation-text span:nth-child(4) {
            animation-name: fadeInUp;
            animation-delay: 0.6s;
        }

        .innovation-text span:nth-child(5) {
            animation-name: fadeInUp;
            animation-delay: 0.8s;
        }

        .innovation-text span:nth-child(6) {
            animation-name: fadeInUp;
            animation-delay: 1s;
        }

        

        img {
            animation-name: fadeInUp;
            animation-delay: 1s;
        }

        label * {
            user-select: none;
            transition: 0.5s;
        }

        html {
        background-color: #ebebeb;
        }

        body {
        overflow: hidden;
        }

        label {
        width: 150px;
        height: 75px;
        background-color: #d55050;
        box-shadow: inset 0px 6px 0px 0px rgba(0, 0, 0, 0.2);
        border-radius: 10px;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%,-50%);
        z-index: 2;
        }

        input:checked ~ label {
        background-color: #50d5a1;
        }

        input:checked ~ label div.s {
        margin-left: 74px;
        }

        label div.s {
        width: 70px;
        height: 64px;
        background-color: #fafafa;
        border-radius: 8px;
        position: relative;
        top: 3px;
        left: 3px;
        box-shadow: 0px 5px 0px 0px #d2d2d2;
        cursor: pointer;
        }

        label div div.d {
        width: 7px;
        height: 7px;
        background-color: #ebebeb;
        position: relative;
        border-radius: 2.5px;
        box-shadow: inset 0px 1.5px 0px 0px rgba(0, 0, 0, 0.2);
        position: absolute;
        }

        label div div.d:nth-child(1) {
        left: 18px;
        top: 15px;
        }

        label div div.d:nth-child(2) {
        left: 32px;
        top: 15px;
        }

        label div div.d:nth-child(3) {
        left: 46px;
        top: 15px;
        }

        label div div.d:nth-child(4) {
        left: 18px;
        top: 28px;
        }

        label div div.d:nth-child(5) {
        left: 32px;
        top: 28px;
        }

        label div div.d:nth-child(6) {
        left: 46px;
        top: 28px;
        }

        label div div.d:nth-child(7) {
        left: 18px;
        top: 42px;
        }

        label div div.d:nth-child(8) {
        left: 32px;
        top: 42px;
        }

        label div div.d:nth-child(9) {
        left: 46px;
        top: 42px;
        }

        input {
        display: none;
        appearance: none;
        }
    </style>
</head>

<body style="margin: 0; overflow: hidden; height:100%;">
    <img src="logo.png" style="position:absolute; z-index: 5; height:50px; width:50px; top:20px; left:20px;" alt="Logo" />
	
    <div class="controls" style="position:absolute; z-index: 100; height:50px; top:20px; right:20px;">
                <button id="button">Get camera</button>
                <select id="select">
                    <option></option>
                  </select>
            </div>
    <div class="animated-text">
        <span>Made</span>&nbsp; <span>with</span>&nbsp; <span class="heart">‚ù§</span>&nbsp; <span>by</span>&nbsp;
        <span><b>ESPRIT</b></span>&nbsp;
        <span>students</span>
        
    </div>
    <div class="innovation-text">
        <span class="red"><b>10</b></span>&nbsp; <span>years</span>&nbsp; <span>of</span>&nbsp;
        <span>innovation</span>&nbsp;<span>üéà</span></br>
        
    </div>
	
    <div style="z-index: 5; position:absolute; width:100%; height:100%;">
        <div class="white-bg" style="pointer-events: none; z-index: 5; width:100%; height:100%; background-color: white;">
            
        </div>
        <div class="buttons-div" style="display:none; white-space: nowrap; position:sticky; bottom:0px; height:100px; width:100%; z-index: -1; background-color: white;  text-align: center;">
            <input id='checkbox' type='checkbox' checked onchange="checkVisible()">
            <label for='checkbox'>
            <div class='s'>
                <div class='d'></div>
                <div class='d'></div>
                <div class='d'></div>
                <div class='d'></div>
                <div class='d'></div>
                <div class='d'></div>
                <div class='d'></div>
                <div class='d'></div>
                <div class='d'></div>
            </div>
            </label>
			


        </div>
		<br>
            
        <div class="logo-div" style="display:none; position:sticky; bottom:0px; height:10%; width:100%; z-index: -1; background-color: white;  text-align: center;">
            
        </div>
    </div>
    
    
    <a-scene id="scene" vr-mode-ui="enabled: false;" loading-screen="enabled: false;" renderer="logarithmicDepthBuffer: true; antialias: true; colorManagement: true; sortObjects: true; physicallyCorrectLights: true; maxCanvasWidth: 1920; maxCanvasHeight: 1920;"
        arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;" id="scene" embedded gesture-detector>
        <a-assets>
            <a-asset-item id="animated-asset" src="MapBaked.glb"></a-asset-item>
            <a-asset-item id="animated-asset2" src="assets/Screen.glb"></a-asset-item>

            <!--
            Image source: http://www.ghibli.jp/works/kazetachinu/#frame&gid=1&pid=1
            Image author: Studio Ghibli
            -->
            <img id="pic1" src="assets/img/pic1.jpg" crossorigin="anonymous"/>
            <img id="pic2" src="assets/img/pic2.jpg" crossorigin="anonymous"/>
            <img id="pic3" src="assets/img/pic3.jpg" crossorigin="anonymous"/>
            <img id="pic4" src="assets/img/pic4.jpg" crossorigin="anonymous"/>
            <img id="pic5" src="assets/img/pic5.jpg" crossorigin="anonymous"/>
            <img id="pic6" src="assets/img/pic6.jpg" crossorigin="anonymous"/>
            <img id="pic6" src="assets/img/pic7.jpg" crossorigin="anonymous"/>
            <img id="pic6" src="assets/img/pic8.jpg" crossorigin="anonymous"/>
            <img id="pic6" src="assets/img/pic9.jpg" crossorigin="anonymous"/>
            <img id="kazetachinuPoster" src="https://cdn.aframe.io/examples/ui/kazetachinuPoster.jpg" crossorigin="anonymous"/>
            <!--
            Image source: http://www.ghibli.jp/works/ponyo/#frame&gid=1&pid=36
            Image author: Studio Ghibli
            -->
            <img id="ponyo" src="https://cdn.aframe.io/examples/ui/ponyo.jpg" crossorigin="anonymous"/>
            <img id="ponyoPoster" src="https://cdn.aframe.io/examples/ui/ponyoPoster.jpg" crossorigin="anonymous"/>
            <!--
            Image source: http://www.ghibli.jp/works/karigurashi/#frame&gid=1&pid=32
            Image author: Studio Ghibli
            -->
            <img id="karigurashi" src="https://cdn.aframe.io/examples/ui/karigurashi.jpg" crossorigin="anonymous"/>
            <img id="karigurashiPoster" src="https://cdn.aframe.io/examples/ui/karigurashiPoster.jpg" crossorigin="anonymous"/>
            <a-mixin
            id="frame"
            geometry="primitive: plane; width: 0.5783552; height: 0.8192"
            material="color: white; shader: flat"
            animation__scale="property: scale; to: 1.2 1.2 1.2; dur: 200; startEvents: mouseenter"
            animation__scale_reverse="property: scale; to: 1 1 1; dur: 200; startEvents: mouseleave"
            ></a-mixin>
            <a-mixin
            id="poster"
            geometry="primitive: plane; width: 0.544768; height: 0.786432"
            material="color: white; shader: flat"
            material="shader: flat"
            position="0 0 0.005"
            ></a-mixin>
            <a-mixin
            id="movieImage"
            geometry="primitive: plane; width: 1.5; height: 0.81"
            material="src: #ponyo; shader: flat; transparent: true"
            position="0 0.495 0.002"
            ></a-mixin>
            
        </a-assets>

        <a-marker id="animated-marker" type="pattern" preset="custom" url="assets/marker.patt"
            raycaster="objects: .clickable" emitevents="true" cursor="fuse: false; rayOrigin: mouse;" id="markerA">
            <a-entity unlit id="bowser-model" look-at-selected="targetNames: ABCParent, HParent, GParent, EParent, DParent, MParent, IJKParent ; axis: x;" scale="0.3 0.3 0.3" rotation="0 -90 0" animation-mixer="loop: repeat"
                gltf-model="#animated-asset" class="clickable" gesture-handler ></a-entity>
        </a-marker>

        <a-entity tex-swap unlit id="pics-model" scale="0.5 0.5 0.5" rotation="0 90 0" position="0 0 -2.2" 
                gltf-model="#animated-asset2" ></a-entity>

        <a-entity camera></a-entity>
    </a-scene>
    <script>
        AFRAME.registerComponent('look-at-selected', {
          schema: {
            targetNames: { type: 'array', default: [] },
            axis: { type: 'string', default: 'x' },
            additionalRotation: { type: 'vec3', default: { x: 0, y: 0, z: 0 } }
          },
      
          init: function () {
            this.el.addEventListener('model-loaded', () => {
              const object3D = this.el.object3D;
              if (!object3D) { return; }
      
              this.targetObjects = this.data.targetNames.map(name => object3D.getObjectByName(name)).filter(obj => obj);
            });
          },
      
          tick: function () {
            const camera = this.el.sceneEl.camera;
            if (!camera || !this.targetObjects) { return; }
      
            const axis = this.data.axis.toLowerCase();
            const upAxis = ['x', 'y', 'z'].find(ax => ax !== axis);
      
            this.targetObjects.forEach(target => {
              if (target) {
                const worldPosition = new THREE.Vector3();
                const cameraPosition = new THREE.Vector3();
                target.getWorldPosition(worldPosition);
                camera.getWorldPosition(cameraPosition);
      
                const direction = new THREE.Vector3();
                direction.subVectors(cameraPosition, worldPosition).normalize();
      
                const rotationQuaternion = new THREE.Quaternion();
                rotationQuaternion.setFromUnitVectors(new THREE.Vector3().setComponent(axisMap[axis], 1), direction);
                const upVector = new THREE.Vector3().setComponent(axisMap[upAxis], 1);
                const adjustedUp = new THREE.Vector3().crossVectors(direction.clone().cross(upVector), direction).normalize();
      
                target.quaternion.copy(rotationQuaternion);
                target.up.copy(adjustedUp);
                target.lookAt(cameraPosition);
      
                
              }
            });
          }
        });
      
        const axisMap = {
          x: 0,
          y: 1,
          z: 2
        };
    </script>

    <script>

        
        
        window.picsVisible = true;
        window.animPlaying = true;
        function checkVisible()
        {
            window.picsVisible = document.querySelector('#checkbox').checked;
            applyVisible();
        }
        function applyVisible()
        {
            var model = document.querySelector("#pics-model");
            model.setAttribute("visible", window.picsVisible && window.animPlaying);
        }
AFRAME.registerComponent('tex-swap',
    {
    init: function() {
      //const {src} = document.getElementById('imageFile')
      const loader = new THREE.TextureLoader()
      var self = this;
      window.setTexture = function(pic) {
        const model = self.el;
        console.log("model = ");
        console.log(model);
        


        let mesh = self.el.getObject3D('mesh')
        // assuming you want all nodes to have the same material        

            
        mesh.traverse(function(node) {
            // change only the mesh nodes
            if(node.type != "Mesh" || node.name != "Screen") return;
            console.log(node);
            console.log("pic = " + pic);
            node.material = node.material.clone();
            node.material.emissiveMap = new THREE.TextureLoader().load( pic );
            // set flipY to false to correclty rotate texture
            node.material.emissiveMap.flipY = false
            node.material.needsUpdate = true;
        })
        var oldTimeout = window.lastTimeout;
        model.setAttribute('animation-mixer', {
            loop: 'repeat',
        });
        window.animPlaying = true;
        applyVisible();
        window.lastTimeout = setTimeout(function()
        {
            model.removeAttribute('animation-mixer');
            window.animPlaying = false;
            applyVisible();
        },3900);
        clearTimeout(oldTimeout);

      }
    }
  });

        const animatedText = document.querySelector(".animated-text");
        const innovationText = document.querySelector(".innovation-text");
        const whitebg = document.querySelector(".white-bg");
        const btns = document.querySelector(".buttons-div");
        const buttons = document.querySelectorAll("button");
        const logo = document.querySelector("img");

        setTimeout(() => {
            animatedText.style.animation = "fadeOutUp 1s ease-in-out forwards";
        }, 3000);

        setTimeout(() => {
            animatedText.style.display = "none";
            innovationText.style.display = "flex";
            innovationText.querySelectorAll("span").forEach((span) => {
                span.style.animationPlayState = "running";
            });
        }, 4000);

        setTimeout(() => {
            innovationText.style.animation = "fadeOutUp 1s ease-in-out forwards";
        }, 7000);

        setTimeout(() => {
            innovationText.style.display = "none";
            whitebg.style.animation = "fadeOutUp 1s ease-in-out forwards";
            btns.style.display = "inline-block";
            /*buttons.forEach((button) => {
                button.style.display = "inline";
                button.style.animation = "fadeIn 1s ease-in-out forwards";
            });*/
            //logo.style.display = "inline";
            //logo.style.animation = "fadeIn 1s ease-in-out forwards";
        }, 8000);

        window.picCounter = 1;
        function swapPic()
        {
            
            window.setTexture(document.getElementById("pic"+window.picCounter).src)
            window.picCounter++;
            if(window.picCounter>7)window.picCounter=1;
        }
        setTimeout(function()
        {
            swapPic();
            setInterval(swapPic,10000);
        },5000);

        






        const video = document.getElementById('arjs-video');
        const button = document.getElementById('button');
        const select = document.getElementById('select');
        let currentStream;

        function stopMediaTracks(stream) {
        stream.getTracks().forEach(track => {
            track.stop();
        });
        }

        function gotDevices(mediaDevices) {
        select.innerHTML = '';
        select.appendChild(document.createElement('option'));
        let count = 1;
        mediaDevices.forEach(mediaDevice => {
            if (mediaDevice.kind === 'videoinput') {
            const option = document.createElement('option');
            option.value = mediaDevice.deviceId;
            const label = mediaDevice.label || `Camera ${count++}`;
            const textNode = document.createTextNode(label);
            option.appendChild(textNode);
            select.appendChild(option);
            }
        });
        }

        button.addEventListener('click', event => {
        if (typeof currentStream !== 'undefined') {
            stopMediaTracks(currentStream);
        }
        const videoConstraints = {};
        if (select.value === '') {
            videoConstraints.facingMode = 'environment';
        } else {
            videoConstraints.deviceId = { exact: select.value };
        }
        const constraints = {
            video: videoConstraints,
            audio: false
        };
        navigator.mediaDevices
			.getUserMedia(constraints)
			.then((stream) => {
			  currentStream = stream;

			  document.getElementById('arjs-video').srcObject = stream;
			  var event = new CustomEvent("camera-init", { stream: stream });
			  window.dispatchEvent(event);

			  document.body.addEventListener("click", function () {
				  document.getElementById('arjs-video').play();
				});
			  return navigator.mediaDevices.enumerateDevices();
			})
			.then(gotDevices)
			.catch((error) => {
			  console.error(error);
			});
        });

        navigator.mediaDevices.enumerateDevices().then(gotDevices);
    </script>
</body>

</html>







